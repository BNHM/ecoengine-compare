!function(e){"use strict";function r(){function r(){m.map=L.map("map",{minZoom:2,maxZoom:17,scrollWheelZoom:!1}).setView([37.5333,-77.4667],2),window.STMN.map=m.map,window.STMN.layers=v,new L.Hash(m.map),M.push(L.tileLayer("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})),M[M.length-1].addTo(m.map),b.baselayer="http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",v.baselayer=M[M.length-1],m.layerMenu.on("orderChanged",function(e){e.caller.order.forEach(function(e){S[e.id]=e,u(e)}),m.on("showLayer",function(){t(m.layerMenu.getLayerOrder())}),t(e.caller.order),n()}),m.layerMenu.on("layerRemoved",function(e){m.map.removeLayer(v[e.caller]),delete v[e.caller],delete w[e.caller],delete S[e.caller],n()}),m.layerMenu.on("color-change",function(e){S[layerObject.id]=e.caller,("pointlayer"===e.caller.list||"hexlayer"===e.caller.list)&&(v[e.caller.id].getLayers()[0].options.colorRange=[e.caller.color,e.caller.color],v[e.caller.id].getLayers()[0].colorScale().range([e.caller.color,e.caller.color]),v[e.caller.id].getLayers()[0]._redraw()),"hulllayer"===e.caller.list&&v[e.caller.id]._featureGroup.getLayers().forEach(function(r){var t;r._icon&&(t=r._icon.querySelector(".innerMarker"),t&&(t.style.backgroundColor=e.caller.color)),r._group&&r._group.getLayers().forEach(function(r){(r._path||r._radius)&&r.setStyle({color:e.caller.color,fillColor:e.caller.color})})}),m.utils.debounce(n,1e4)()}),document.querySelector("#hexagon-radius").addEventListener("change",function(e){document.querySelector("label[for=hexagon-radius]").innerHTML="Radius "+document.querySelector("#hexagon-radius").value+"px",m.map.eachLayer(function(r){if(r.__sHexLayer===!0){r.getLayers()[0].options.radius=+e.target.value,r.getLayers()[0].options.radiusRange=[Math.max(1,Math.sqrt(+e.target.value)-1),+e.target.value];var t=r.getLayers()[0]._data;r.getLayers()[0].initialize(r.options),r.getLayers()[0].data(t)}})}),document.querySelector("label[for=hexagon-radius]").innerHTML="Radius "+document.querySelector("#hexagon-radius").value+"px"}function t(e){e.forEach(function(e,r){v[e.id]&&v[e.id].setZIndex&&v[e.id].setZIndex(r+1)})}function a(e){var r=y.getLayerNode(e);r.classList.add("progress"),m.utils.append(r,'<div class="loaderwrapper"><div id="floatingCirclesG" class="loading"><div class="f_circleG" id="frotateG_01"></div><div class="f_circleG" id="frotateG_02"></div><div class="f_circleG" id="frotateG_03"></div><div class="f_circleG" id="frotateG_04"></div><div class="f_circleG" id="frotateG_05"></div><div class="f_circleG" id="frotateG_06"></div><div class="f_circleG" id="frotateG_07"></div><div class="f_circleG" id="frotateG_08"></div></div></div>')}function o(e){var r=y.getLayerNode(e),t=r.querySelector(".loaderwrapper");r.classList.remove("progress"),t&&t.parentNode.removeChild(t)}function n(){var e=y.getMenuState();e=e.map(function(e){return delete e.element,e.uri=e.uri.replace(/%22/g,"'"),e}),m.statefulQueryString.set("state",encodeURIComponent(LZString.compressToBase64(JSON.stringify(e))))}function i(e){y.getMenuState();a(e),m.showLayer(e,function(){o(e)}),n()}function l(e,r){S[e.id]||(S[e.id]=e),(S[e.id]&&r||"raster"===S[e.id].list)&&("raster"!==!S[e.id].list&&b[e.id]&&b[e.id]===e.uri||("raster"===S[e.id].list&&(b[e.id]=S[e.id].uri),v[e.id]&&(m.map.removeLayer(v[e.id]),delete v[e.id]),v[e.id]||(v[e.id]=_[S[e.id].list](r,S[e.id]),v[e.id].__sOriginURI=S[e.id].uri,v[e.id].__sOriginList=S[e.id].list,m.map.addLayer(v[e.id]))))}function c(){var r,t=document.querySelector("#legend-layer-menu-min"),n=document.querySelector("#legend-layer-menu .close-button");try{r=JSON.parse(decodeURIComponent(LZString.decompressFromBase64(m.statefulQueryString.get("state"))))}catch(l){r=null}console.log(e.LegendLayerMenu),y=new e.LegendLayerMenu("#legend-layer-menu",{menuState:r}),m.layerMenu=y,r=y.getMenuState(),r&&r.forEach(function(e){a(e),m.showLayer(e,function(){o(e)})}),y.on("layerUpdated",function(e){e.caller.updatedProperties.indexOf("uri")>-1&&(p(e.caller.layerObject.id,e.caller.layerObject.list),delete w[e.caller.layerObject.id],i(e.caller.layerObject))}),y.on("layerAdded",function(e){i(e.caller)}),y.on("layer-click",function(e){var r=m.utils.parentHasClass(e.caller.event.target,"loaderwrapper",3);r&&g.stopRecursiveRequest(x[e.caller.layerObject.id].id)}),t.addEventListener("click",function(){y.rootNode.classList.contains("open")?y.rootNode.classList.remove("open"):y.rootNode.classList.add("open")},!1),n.addEventListener("click",function(){y.rootNode.classList.remove("open")},!1)}function s(){m.statefulQueryString=new e.StatefulQueryString}function d(){f=y.rootNode.querySelector(".ecoengine-compare .share-button"),f&&f.addEventListener("click",function(){var e=new XMLHttpRequest;e.open("POST","https://www.googleapis.com/urlshortener/v1/url",!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status?(swal({title:"Here is your share link",text:JSON.parse(e.responseText).id,confirmButtonText:"All done",confirmButtonColor:"rgb(103,171,236)",closeOnConfirm:!0,customClass:"modal-share"}),setTimeout(function(){var e=document.querySelector(".sweet-alert");e&&e.removeAttribute("tabIndex")},100)):swal("Here's the thing","We were not able to create a short URL. Please check your connection and try again in a few minutes.","error")},e.send('{"longUrl": "'+location.href+'"}')},!1)}function u(r,t){g||(g=new e.EcoengineClient),m.on("page-recieved",function(e){e.caller.data>=h&&(g.stopRecursiveRequest(e.caller.target.id),swal("A layer has reached the maximum number of records ("+h+") and has been stopped."))}),w[r.id]||"raster"===r.list?l(r,w[r.id]):x[r.id]=g.requestRecursive(r.uri.replace(/'/g,'"'),function(e,a){e&&0!==e.status&&swal("Loading problem",'There was an error communicating with the server for the request labeled "'+r.label+'"'),w[r.id]=a,l(r,a),m.fire("showLayer"),"function"==typeof t&&t()},function(e,t){w[r.id]=t,l(r,t),m.fire("showLayerProgress")})}function p(e){m.map.removeLayer(v[e]),m.fire("showLayer",{layer:v[e]})}var y,f,g,m=this,h=5e4,v={},w={},b={},S={},x={},_={pointlayer:function(e,r){var t=new L.HexbinLayer({radiusRange:[4,4],radius:2,opacity:1,colorRange:[r.color,r.color]}).addTo(m.map);t.data(e.filter(function(e){return"object"==typeof e.geometry&&null!==e.geometry}).map(function(e){return e.geometry.coordinates}));var a=L.featureGroup([t]).addTo(m.map);return a},hulllayer:function(e,r){var t=new L.MarkerClusterGroup({maxClusterRadius:80,polygonOptions:{color:r.color,stroke:!1,opacity:.7}});return e.forEach(function(e){e.geometry&&t.addLayer(L.circleMarker([e.geometry.coordinates[1],e.geometry.coordinates[0]],{fillColor:r.color,fillOpacity:.5,stroke:!1}))}),t},hexlayer:function(e,r){function t(e){var r=e.i,t=e.j,a=[];m.map.eachLayer(function(e){if(e.__sHexLayer===!0){var o=e.getLayers()[0].hexagons.filter(function(e){return e.i==r&&e.j==t}).data();a=a.concat(o[0])}});var o=a.filter(function(e){return!!e}).map(function(e){var r=e.d.properties;return r.long=e.d.geometry.coordinates[0],r.lat=e.d.geometry.coordinates[1],r});return o}var a=+document.querySelector("#hexagon-radius").value,o=new L.HexbinLayer({radiusRange:[Math.max(1,Math.sqrt(a)-1),a],radius:a,opacity:1,colorRange:[r.color,r.color]}).addTo(m.map);o.hexMouseOver(function(e){var r=t(e);m.popup=L.popup({closeButton:!1}).setLatLng(m.map.layerPointToLatLng([e.x,e.y])).setContent(""+r.length+" Observations<br/><span style='color: #999;font-size: 0.8em;'>Click to export</span>").openOn(m.map)}),o.hexMouseOut(function(){d3.selectAll(".leaflet-popup").style("display","none")}),o.hexClick(function(e){var r=window.open("","wnd");r.document.body.innerHTML="<pre>"+d3.csv.format(t(e))+"</pre>"}),o.data(e.filter(function(e){return"object"==typeof e.geometry&&null!==e.geometry}).map(function(e){return e[0]=e.geometry.coordinates[0],e[1]=e.geometry.coordinates[1],e}));var n=L.featureGroup([o]).addTo(m.map);return n.__sHexLayer=!0,n},raster:function(e,r){return console.log(e,r),M.push(L.tileLayer(r.uri,{transparent:!0,unloadInvisibleTiles:!0})),M[M.length-1].addTo(m.map),M[M.length-1]}},M=[];return m.utils=STPX.browsersugar.mix({}),m.showLayer=u,m.hideLayer=p,m.showMenuItemLoadState=a,m.hideMenuItemLoadState=o,s(),c(),r(),d(),m}new(STPX.samesies.extend(r))}(window.STMN);
//# sourceMappingURL=index.min.js.map