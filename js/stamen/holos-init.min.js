function IndexController(){function e(){var e;if(g.map=L.map("map",{minZoom:2,maxZoom:17,scrollWheelZoom:!1}).setView([37.5333,-77.4667],2),window.STMN.map=g.map,window.STMN.layers=v,new L.Hash(g.map),T.push(L.tileLayer(document.querySelector("#layer-select").value,{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})),T[T.length-1].addTo(g.map),w.baselayer=document.querySelector("#layer-select").value,v.baselayer=document.querySelector("#layer-select").value,_.d)for(var t in _.d)_.d.hasOwnProperty(t)&&_.d[t].length&&(e=document.querySelector("#"+t),e&&i({list:"raster",id:e.getAttribute("data-id"),uri:_.d[t]}));g.layerMenu.on("orderChanged",function(e){e.caller.order.forEach(function(e){M[e.id]=e,s(e)}),g.on("showLayer",function(){r(g.layerMenu.getLayerOrder())}),r(e.caller.order),a()}),g.layerMenu.on("layerRemoved",function(e){g.map.removeLayer(v[e.caller]),delete v[e.caller],delete S[e.caller],delete M[e.caller],a()}),g.layerMenu.on("color-change",function(e){M[layerObject.id]=e.caller,("pointlayer"===e.caller.list||"hexlayer"===e.caller.list)&&(v[e.caller.id].getLayers()[0].options.colorRange=[e.caller.color,e.caller.color],v[e.caller.id].getLayers()[0].colorScale().range([e.caller.color,e.caller.color]),v[e.caller.id].getLayers()[0]._redraw()),"hulllayer"===e.caller.list&&v[e.caller.id]._featureGroup.getLayers().forEach(function(r){var t;r._icon&&(t=r._icon.querySelector(".innerMarker"),t&&(t.style.backgroundColor=e.caller.color)),r._group&&r._group.getLayers().forEach(function(r){(r._path||r._radius)&&r.setStyle({color:e.caller.color,fillColor:e.caller.color})})}),g.utils.debounce(a,1e4)()}),document.querySelector("#hexagon-radius").addEventListener("change",function(e){document.querySelector("label[for=hexagon-radius]").innerHTML="Radius "+document.querySelector("#hexagon-radius").value+"px",g.map.eachLayer(function(r){if(r.__sHexLayer===!0){r.getLayers()[0].options.radius=+e.target.value,r.getLayers()[0].options.radiusRange=[Math.max(1,Math.sqrt(+e.target.value)-1),+e.target.value];var t=r.getLayers()[0]._data;r.getLayers()[0].initialize(r.options),r.getLayers()[0].data(t)}}),a()}),document.querySelector("label[for=hexagon-radius]").innerHTML="Radius "+document.querySelector("#hexagon-radius").value+"px"}function r(e){e.forEach(function(e,r){v[e.id]&&v[e.id].setZIndex&&v[e.id].setZIndex(r+1)})}function t(e){var r=y.getLayerNode(e);r.classList.add("progress"),g.utils.append(r,'<div class="loaderwrapper"><div id="floatingCirclesG" class="loading"><div class="f_circleG" id="frotateG_01"></div><div class="f_circleG" id="frotateG_02"></div><div class="f_circleG" id="frotateG_03"></div><div class="f_circleG" id="frotateG_04"></div><div class="f_circleG" id="frotateG_05"></div><div class="f_circleG" id="frotateG_06"></div><div class="f_circleG" id="frotateG_07"></div><div class="f_circleG" id="frotateG_08"></div></div></div>')}function o(e){var r=y.getLayerNode(e),t=r.querySelector(".loaderwrapper");r.classList.remove("progress"),t&&t.parentNode.removeChild(t)}function a(){var e=y.getMenuState(),r={};e=e.map(function(e){return delete e.element,e.uri=e.uri.replace(/%22/g,"'"),e}),r.m=e,r.d=y.getDropdownState(),r.r=document.querySelector("#hexagon-radius").value,g.statefulQueryString.set("state",encodeURIComponent(LZString.compressToBase64(JSON.stringify(r))))}function n(e){y.getMenuState();t(e),g.showLayer(e,function(){o(e)}),a()}function i(e,r){M[e.id]||(M[e.id]=e),(M[e.id]&&r||"raster"===M[e.id].list)&&("raster"!==!M[e.id].list&&w[e.id]&&w[e.id]===e.uri||("raster"===M[e.id].list&&(w[e.id]=M[e.id].uri),v[e.id]&&(g.map.removeLayer(v[e.id]),delete v[e.id]),v[e.id]||(v[e.id]=b[M[e.id].list](r,M[e.id]),v[e.id].__sOriginURI=M[e.id].uri,v[e.id].__sOriginList=M[e.id].list,g.map.addLayer(v[e.id]))))}function l(){var e=document.querySelector("#legend-layer-menu-min"),r=document.querySelector("#legend-layer-menu .close-button");try{_=JSON.parse(decodeURIComponent(LZString.decompressFromBase64(g.statefulQueryString.get("state"))))}catch(a){}y=new STMN.LegendLayerMenu("#legend-layer-menu",{menuState:_.m,dropdownState:_.d}),g.layerMenu=y,_.r&&(document.querySelector("#hexagon-radius").value=_.r),_&&!_.m&&(_.m=y.getMenuState()),_.m&&_.m.forEach(function(e){t(e),g.showLayer(e,function(){o(e)})}),y.on("layerUpdated",function(e){e.caller.updatedProperties.indexOf("uri")>-1&&(d(e.caller.layerObject.id,e.caller.layerObject.list),delete S[e.caller.layerObject.id],n(e.caller.layerObject))}),y.on("layerAdded",function(e){n(e.caller)}),y.on("layer-click",function(e){var r=g.utils.parentHasClass(e.caller.event.target,"loaderwrapper",3);r&&(y.showLayerError(e.caller.layerObject.id,"This layer was canceled before it's data had loaded completely"),x[e.caller.layerObject.id].forEach(function(){m.stopRecursiveRequest(x[e.caller.layerObject.id][0].id)}))}),e.addEventListener("click",function(){y.rootNode.classList.contains("open")?y.rootNode.classList.remove("open"):y.rootNode.classList.add("open")},!1),r.addEventListener("click",function(){y.rootNode.classList.remove("open")},!1)}function c(){g.statefulQueryString=new STMN.StatefulQueryString}function u(){p=y.rootNode.querySelector(".ecoengine-compare .share-button"),p&&p.addEventListener("click",function(){var e=new XMLHttpRequest;e.open("POST","https://www.googleapis.com/urlshortener/v1/url",!0),e.setRequestHeader("Content-type","application/json"),e.onreadystatechange=function(){4==e.readyState&&200==e.status?(swal({title:"Here is your share link",text:JSON.parse(e.responseText).id,confirmButtonText:"All done",confirmButtonColor:"rgb(103,171,236)",closeOnConfirm:!0,customClass:"modal-share"}),setTimeout(function(){var e=document.querySelector(".sweet-alert");e&&e.removeAttribute("tabIndex")},100)):swal("Here's the thing","We were not able to create a short URL. Please check your connection and try again in a few minutes.","error")},e.send('{"longUrl": "'+location.href+'"}')},!1)}function s(e,r){m||(m=new STMN.EcoengineClient),S[e.id]||"raster"===e.list?i(e,S[e.id]):x[e.id]=m.requestRecursive(e.uri.replace(/'/g,'"'),function(t,o){t&&0!==t.status&&y.showLayerError(e.id,"There was an error communicating with the server"),o&&!o.length?y.showLayerError(e.id,"This query returned 0 records."):(S[e.id]=o,i(e,o)),g.fire("showLayer"),"function"==typeof r&&r()},function(r,t){S[e.id]=t,i(e,t),t.length>=h&&(m.stopRecursiveRequest(x[e.id].id),y.showLayerError(e.id,"A layer has reached the maximum number of records ("+h+") and has been stopped.")),g.fire("showLayerProgress")})}function d(e){g.map.removeLayer(v[e]),g.fire("showLayer",{layer:v[e]})}function f(){c(),l(),e(),u()}var y,p,m,g=this,h=5e4,v={},S={},w={},M={},x={},b={pointlayer:function(e,r){var t=new L.HexbinLayer({radiusRange:[4,4],radius:2,opacity:1,colorRange:[r.color,r.color]}).addTo(g.map);t.data(e.filter(function(e){return"object"==typeof e.geometry&&null!==e.geometry}).map(function(e){return e.geometry.coordinates}));var o=L.featureGroup([t]).addTo(g.map);return o},hulllayer:function(e,r){var t=new L.MarkerClusterGroup({maxClusterRadius:80,polygonOptions:{color:r.color,stroke:!1,opacity:.7}});return e.forEach(function(e){e.geometry&&t.addLayer(L.circleMarker([e.geometry.coordinates[1],e.geometry.coordinates[0]],{fillColor:r.color,fillOpacity:.5,stroke:!1}))}),t},hexlayer:function(e,r){function t(e){var r=e.i,t=e.j,o=[];g.map.eachLayer(function(e){if(e.__sHexLayer===!0){var a=e.getLayers()[0].hexagons.filter(function(e){return e.i==r&&e.j==t}).data();o=o.concat(a[0])}});var a=o.filter(function(e){return!!e}).map(function(e){var r=e.d.properties;return r.long=e.d.geometry.coordinates[0],r.lat=e.d.geometry.coordinates[1],r});return a}var o=+document.querySelector("#hexagon-radius").value,a=new L.HexbinLayer({radiusRange:[Math.max(1,Math.sqrt(o)-1),o],radius:o,opacity:1,colorRange:[r.color,r.color]}).addTo(g.map);a.hexMouseOver(function(e){var r=t(e);g.popup=L.popup({closeButton:!1}).setLatLng(g.map.layerPointToLatLng([e.x,e.y])).setContent(""+r.length+" Observations<br/><span style='color: #999;font-size: 0.8em;'>Click to export</span>").openOn(g.map)}),a.hexMouseOut(function(){d3.selectAll(".leaflet-popup").style("display","none")}),a.hexClick(function(e){var r=window.open("","wnd");r.document.body.innerHTML="<pre>"+d3.csv.format(t(e))+"</pre>"}),a.data(e.filter(function(e){return"object"==typeof e.geometry&&null!==e.geometry}).map(function(e){return e[0]=e.geometry.coordinates[0],e[1]=e.geometry.coordinates[1],e}));var n=L.featureGroup([a]).addTo(g.map);return n.__sHexLayer=!0,n},raster:function(e,r){return T.push(L.tileLayer(r.uri,{transparent:!0,unloadInvisibleTiles:!0})),T[T.length-1].addTo(g.map),T[T.length-1]}},T=[],_={};return g.utils=STPX.browsersugar.mix({}),g.showLayer=s,g.hideLayer=d,g.showMenuItemLoadState=t,g.hideMenuItemLoadState=o,f(),g}!function(){d3.hexbin=function(){function o(e){var r={};return e.forEach(function(e,t){var a=d.call(o,e,t)/l,n=Math.round(a),c=s.call(o,e,t)/i-(1&n?.5:0),u=Math.round(c),f=a-n;if(3*Math.abs(f)>1){var y=c-u,p=u+(u>c?-1:1)/2,m=n+(n>a?-1:1),g=c-p,h=a-m;y*y+f*f>g*g+h*h&&(u=p+(1&n?1:-1)/2,n=m)}var v=u+"-"+n,L=r[v];L?L.push(e):(L=r[v]=[e],L.i=u,L.j=n,L.x=(u+(1&n?.5:0))*i,L.y=n*l)}),d3.values(r)}function a(r){var t=0,o=0;return e.map(function(e){var a=Math.sin(e)*r,n=-Math.cos(e)*r,i=a-t,l=n-o;return t=a,o=n,[i,l]})}var n,i,l,c=1,u=1,s=r,d=t;return o.x=function(e){return arguments.length?(s=e,o):s},o.y=function(e){return arguments.length?(d=e,o):d},o.hexagon=function(e){return arguments.length<1&&(e=n),"m"+a(e).join("l")+"z"},o.centers=function(){for(var e=[],r=0,t=!1,o=0;u+n>r;r+=l,t=!t,++o)for(var a=t?i/2:0,s=0;c+i/2>a;a+=i,++s){var d=[a,r];d.i=s,d.j=o,e.push(d)}return e},o.mesh=function(){var e=a(n).slice(0,4).join("l");return o.centers().map(function(r){return"M"+r+"m"+e}).join("")},o.size=function(e){return arguments.length?(c=+e[0],u=+e[1],o):[c,u]},o.radius=function(e){return arguments.length?(n=+e,i=2*n*Math.sin(Math.PI/3),l=1.5*n,o):n},o.radius(1)};var e=d3.range(0,2*Math.PI,Math.PI/3),r=function(e){return e[0]},t=function(e){return e[1]}}(),function(){"use strict";function e(e,t){return r=new L.MarkerClusterGroup({sColor:t.color,spiderfyDistanceMultiplier:0}),e.forEach(function(e){e.geometry&&r.addLayer(L.marker([e.geometry.coordinates[1],e.geometry.coordinates[0]],{icon:L.divIcon({className:"point-feature-icon point-feature-icon-"+t.color})}))}),r}var r;"object"!=typeof window.STMN&&(window.STMN={}),window.STMN.hullLayer=e,"object"==typeof module&&"object"==typeof module.exports?module.exports=STMN.hullLayer:"function"==typeof define&&define.amd&&define(STMN.hullLayer)}(),function(e){"use strict";function r(){function r(){t=queryString.parse(location.search),o.set(t),o.on("set",function(r){e.pushState({},document.title,"?state="+r.caller.data.state)})}var t,o=this;return e?void r():null}"object"!=typeof window.STMN&&(window.STMN={}),window.STMN.StatefulQueryString=STPX.samesies.extend(r),"object"==typeof module&&"object"==typeof module.exports?module.exports=STMN.StatefulQueryString:"function"==typeof define&&define.amd&&define(["samesies","query-string"],STMN.StatefulQueryString)}(window.history),new(STPX.samesies.extend(IndexController));
//# sourceMappingURL=holos-init.min.js.map